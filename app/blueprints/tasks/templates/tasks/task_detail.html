{% extends "base.html" %}
{% from "_file_tree.html" import render_file_tree %}
{% block content %}
<div class="card mb-3">
  <div class="card-body">
    <div class="d-flex flex-column flex-md-row align-items-md-start justify-content-between gap-2">
      <div>
        <h1 class="h4 mb-2 fw-bold">{{ task.name }}</h1>
        {% if task.description %}
        <p class="text-muted mb-0">{{ task.description }}</p>
        {% else %}
        <p class="text-muted mb-0">-</p>
        {% endif %}
      </div>
      <div class="text-muted small text-md-end">任務 ID：{{ task.id }}</div>
    </div>
    <hr class="my-3">
    <div class="row g-3 small">
      {% if task.creator %}
      <div class="col-md-6">
        <div class="text-muted">建立人員</div>
        <div class="fw-semibold">{{ task.creator }}</div>
      </div>
      {% endif %}
      {% if task.nas_path %}
      <div class="col-md-6">
        <div class="text-muted">NAS 路徑</div>
        <div class="fw-semibold font-monospace text-break">{{ task.nas_path }}</div>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="fw-semibold mb-1">檔案結構</div>
    <div class="text-muted small mb-2">以目錄樹檢視，點擊資料夾可展開內容。</div>
    <div class="file-tree-container">
      {{ render_file_tree(files_tree) }}
    </div>
    <div class="d-flex flex-wrap gap-2 mt-3">
      <a class="btn btn-primary" href="{{ url_for('flows_bp.flow_builder', task_id=task.id) }}">管理流程</a>
      <a class="btn btn-outline-primary" href="{{ url_for('tasks_bp.task_copy_files', task_id=task.id) }}">複製檔案</a>
      <a class="btn btn-outline-primary" href="{{ url_for('tasks_bp.task_mapping', task_id=task.id) }}">上傳 Mapping</a>
      {% if task.nas_path %}
      <form action="{{ url_for('tasks_bp.sync_task_nas', task_id=task.id) }}" method="post" class="d-inline" onsubmit="return confirm('確定要同步 NAS 檔案嗎？這會覆蓋目前任務檔案夾內容。')">
        <button class="btn btn-outline-secondary" type="submit">同步 NAS 檔案</button>
      </form>
      {% endif %}
      <a class="btn btn-outline-secondary" href="{{ url_for('tasks_bp.tasks') }}">返回任務管理</a>
    </div>
  </div>
</div>

{% endblock %}
