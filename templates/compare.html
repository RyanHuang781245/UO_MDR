{% extends "base.html" %}
{% block content %}
<h1 class="h4 mb-3">來源比對</h1>
<div class="row g-3">
  <div class="col-md-8">
    <iframe id="htmlFrame" src="{{ html_url }}" style="width:100%; height:80vh;" class="border"></iframe>
  </div>
  <div class="col-md-4">
    <ul id="sourceList" class="list-group"></ul>
    <div class="mt-3">
      <a class="btn btn-secondary" href="{{ back_link }}">返回結果</a>
    </div>
  </div>
</div>
<script>
const CHAPTER_SOURCES = {{ chapter_sources|tojson }};
const CHAPTERS = {{ chapters|tojson }};
function updateSources(ch){
  const list = document.getElementById('sourceList');
  list.innerHTML = '';
  (CHAPTER_SOURCES[ch] || []).forEach(src => {
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.textContent = src;
    list.appendChild(li);
  });
}
const iframe = document.getElementById('htmlFrame');
iframe.addEventListener('load', () => {
  const doc = iframe.contentDocument || iframe.contentWindow.document;
  CHAPTERS.forEach(ch => {
    const elements = Array.from(doc.body.querySelectorAll('*')).filter(el => el.textContent.trim() === ch);
    elements.forEach(el => {
      el.style.cursor = 'pointer';
      el.addEventListener('click', () => updateSources(ch));
    });
  });
});
</script>
{% endblock %}
